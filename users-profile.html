<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User profile</title>
</head>
<body>
    <H1>Min Side</H1>
    Du kan se alle produkter der er tilsalg <a href="products.html">her</a> <br>
    Ellers kan du oprette et nyt produkt <a href="products-create.html">her</a> <br><br>
    <select id="category-list">
        <option>Alle produkter</option>
        <option>Tøj</option>
        <option>Møbler</option>
        <option>Bildele</option>
        <option>Køkkenudstyr</option>
        <option>Haveudstyr</option>
        <option>Legetøj</option>
        <option>Belysning</option>
        <option>Accessories</option>
        <option>Teknologi</option>
    </select>

    <ul id="list-of-products">
    </ul>

<button onclick="LogOut()">
    Log ud
</button>
<script>
    function LogOut() {
        localStorage.removeItem("name");
        localStorage.removeItem("userId");
        location.href = 'products.html';
    };

    function userProducts(){
        var userId = localStorage.getItem("userId");

        //Lav et nyt request
        const request = new XMLHttpRequest();

        //Skriv hvilke endpoint det skal hente fra
        var url = 'http://localhost:3000/api/users/profile';

        if(userId) {
        url = 'http://localhost:3000/api/users/profile?userId='+userId;
        }

        //Åben forbindelsen til serveren ud fra vores url (endpoint)
        request.open("GET", url);

        //Send request til server
        request.send();

        request.onload = (e) => {

        //Tag response fra vores server, og lav det om til et Javascript object
        var products = JSON.parse(request.response);

        //Udskriv data fra server
        console.log(products)

        //Ny var
         var newListOfMyProcuctsHTML = '';

        //Loop over alle vores products fra vores response
        products.forEach(product => {
        var productId = product.userId;
        newListOfMyProcuctsHTML += '<li>'+product.title+' - '+product.price+' - '+product.description+' - '+product.category+' - '+product.id+' - '+product.userId+' - <button id="'+productId+'" onClick="deleteProductWithId(this.id)">Slet produkt</button> - <a href="products-edit.html?title='+product.title+'&id='+product.id+'&description='+product.description+'&price='+product.price+'&category='+product.category+'">Rediger produkt</a>';
   
        });
        document.getElementById("list-of-products").innerHTML = newListOfMyProcuctsHTML;
   
    }       
}

userProducts();

</script>
</body>
</html>