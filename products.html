<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alle produkter</title>
</head>
<body>

    <h1>Alle produkter</h1>
    <h2>Herunder finder du en liste af produkter</h2>
    Ellers kan du oprette et nyt produkt <a href="products-create.html">her</a>
    <br>
    <br>
    <select id="category-list">
        <option>Alle produkter</option>
        <option>Tøj</option>
        <option>Møbler</option>
        <option>Bildele</option>
        <option>Køkkenudstyr</option>
        <option>Haveudstyr</option>
        <option>Legetøj</option>
        <option>Belysning</option>
        <option>Accessories</option>
        <option>Teknologi</option>
    </select>

    <ul id="list-of-products">
    </ul>

    <script>
        
        let category = document.getElementById('category-list');
        category.addEventListener("change", () => {

            if(category.value == 'Alle produkter') {
                getProducts();
            } else {
                getProducts(category.value);
            }

        });
        
        function getProducts(categoryValue) {

            //Lav et nyt request
            const request = new XMLHttpRequest();

            //Skriv hvilke endpoint det skal hente fra
            var url = 'http://localhost:3000/api/products';

            if(categoryValue) {
                url = 'http://localhost:3000/api/products?category='+categoryValue;
            }

            //Åben forbindelsen til serveren ud fra vores url (endpoint)
            request.open("GET", url);

            //Send request til server
            request.send();

            request.onload = (e) => {

                //Tag response fra vores server, og lav det om til et Javascript object
                var products = JSON.parse(request.response);

                //Udskriv data fra server
                console.log(products)

                //Ny var
                var newListOfProcuctsHTML = '';

                //Loop over alle vores products fra vores response
                products.forEach(product => {
                    var productId = product.id;
                    newListOfProcuctsHTML += '<li>'+product.title+' - '+product.price+' - '+product.description+' - '+product.category+' - '+product.id+' - <button id="'+productId+'" onClick="deleteProductWithId(this.id)">Slet produkt</button> - <a href="products-edit.html?title='+product.title+'&id='+product.id+'&description='+product.description+'&price='+product.price+'&category='+product.category+'">Rediger produkt</a>';
                });

                document.getElementById("list-of-products").innerHTML = newListOfProcuctsHTML;

            }
        }

        getProducts();

        function deleteProductWithId(id) {
            console.log(id);
        //Lav et nyt request
         const request = new XMLHttpRequest();
    
        //Skriv hvilke endpoint det skal hente fra
        const url = 'http://localhost:3000/api/products/delete?id='+id;

        //Åben forbindelsen til serveren ud fra vores url (endpoint)
        request.open("GET", url);


        //Send request til server
        request.send();


        request.onload = (e) => {
        getProducts();
    }
        }
    </script>

</body>
</html>