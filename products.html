<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alle produkter</title>
</head>
<body>

    <h1 id="headline">Alle produkter</h1>
    <h2>Herunder finder du en liste af produkter</h2>
    <select id="category-list">
        <option>Alle produkter</option>
        <option>Tøj</option>
        <option>Møbler</option>
        <option>Bildele</option>
        <option>Køkkenudstyr</option>
        <option>Haveudstyr</option>
        <option>Legetøj</option>
        <option>Belysning</option>
        <option>Accessories</option>
        <option>Teknologi</option>
    </select>

    <ul id="list-of-products">
    </ul>

    kan logge ind eller oprette dig som bruger <a href="users-create.html">her</a><br>

    <a id="MyPageButton" href="users-profile.html">Min side</a>

    <script>
        //Hvis der ikke bliver valgt en kategori, så vis alle produkter
        let category = document.getElementById('category-list');
        category.addEventListener("change", () => {
            if(category.value == 'Alle produkter') {
                getProducts();
            } else {
                getProducts(category.value);
            }
        });
        
        function getProducts(categoryValue) {

            //Lav et nyt request
            const request = new XMLHttpRequest();

            //Skriv hvilke endpoint det skal hente fra
            var url = 'http://localhost:3000/api/products';

            //Hvilket det skal hente fra hvis man vælger en kategori
            if(categoryValue) {
                url = 'http://localhost:3000/api/products?category='+categoryValue;
            }

            //Åben forbindelsen til serveren ud fra vores url (endpoint)
            request.open("GET", url);

            //Send request til server
            request.send();

            request.onload = (e) => {

                //Tag response fra vores server, og lav det om til et Javascript object
                var products = JSON.parse(request.response);

                //Ny var
                var newListOfProcuctsHTML = '';

                //Loop over alle vores products fra vores response
                products.forEach(product => {
                    var productId = product.id;
                    newListOfProcuctsHTML += '<li>'+product.title+' - '+product.price+' - '+product.description+' - '+product.category;
                });
                document.getElementById("list-of-products").innerHTML = newListOfProcuctsHTML;
            };
        };
        //Her kører vi funktionen
        getProducts();

        //Hent navn ud fra localstorage, så når man logger ind bliver det mere personligt ved at tilføje det i overskriften.
        function getUserData() {
            var name = localStorage.getItem("name");
            if(name){
                document.getElementById("headline").innerHTML = 'Velkommen til ' + name;
            }else{
                document.getElementById("headline").innerHTML = 'Alle produkter';
                document.getElementById("MyPageButton").style.visibility = "hidden";
            };
        };
        //Her kører jeg funktionen
        getUserData();


        function deleteProductWithId(id) {
            //Lav et nyt request
            const request = new XMLHttpRequest();
    
            //Skriv hvilke endpoint det skal hente fra
            const url = 'http://localhost:3000/api/products/delete?id='+id;

            //Åben forbindelsen til serveren ud fra vores url (endpoint)
            request.open("GET", url);
            
            //Send request til server
            request.send();

            //produktet er slettet og du henter produkter
            request.onload = (e) => {
                getProducts();
            };
        };
    </script>

</body>
</html>